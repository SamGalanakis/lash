// This file was generated by BAML: do not edit it.
// Instead, edit the BAML source files.
//
// Learn more at https://docs.boundaryml.com

//! Asynchronous BAML client with function-object pattern.

use crate::baml_client::{runtime::{get_runtime, FunctionOptions}, stream_types, types};
use baml::{AsyncStreamingCall, BamlEncode, BamlError};

// =============================================================================
// Convenience Builder Methods Macro
// =============================================================================

/// Implements convenience builder methods that delegate to `with_options`.
/// Requires the type to have:
/// - `options: FunctionOptions` field
/// - `fn with_options(&self, options: FunctionOptions) -> Self` method
macro_rules! impl_options_convenience_methods {
    ($name:ident) => {
        impl $name {
            pub fn with_collector(&self, collector: &baml::Collector) -> Self {
                self.with_options(self.options.clone().with_collector(collector))
            }

            pub fn with_collectors(&self, collectors: &[baml::Collector]) -> Self {
                self.with_options(self.options.clone().with_collectors(collectors))
            }

            pub fn with_cancellation_token(&self, token: Option<baml::CancellationToken>) -> Self {
                self.with_options(self.options.clone().with_cancellation_token(token))
            }

            pub fn with_type_builder(&self, tb: &super::super::type_builder::TypeBuilder) -> Self {
                self.with_options(self.options.clone().with_type_builder(tb))
            }

            pub fn with_env_var(&self, key: impl Into<String>, value: impl Into<String>) -> Self {
                self.with_options(self.options.clone().with_env_var(key, value))
            }

            pub fn with_tag(&self, key: impl Into<String>, value: impl Into<String>) -> Self {
                self.with_options(self.options.clone().with_tag(key, value))
            }

            pub fn with_client(&self, client_name: impl Into<String>) -> Self {
                self.with_options(self.options.clone().with_client(client_name))
            }

            pub fn with_client_registry(&self, registry: &baml::ClientRegistry) -> Self {
                self.with_options(self.options.clone().with_client_registry(registry))
            }
        }
    };
}

// =============================================================================
// Function Struct Macro (generates per-function struct with async methods)
// =============================================================================

macro_rules! baml_function_async {
    ($name:ident($($param:ident : $ptype:ty),* $(,)?) -> ($stream_ret:ty, $final_ret:ty)) => {
        #[derive(Clone)]
        pub struct $name {
            pub(crate) options: FunctionOptions,
        }

        impl $name {
            pub const fn new() -> Self {
                Self { options: FunctionOptions::new() }
            }

            fn with_options(&self, options: FunctionOptions) -> Self {
                Self { options }
            }

            // Terminal methods (async)
            pub async fn call(&self, $($param: $ptype),*) -> Result<$final_ret, BamlError> {
                let args = self.options.to_baml_args()
                    $(.arg(stringify!($param), $param.baml_encode()))*;
                get_runtime().call_function_async(stringify!($name), &args).await
            }

            pub fn stream(&self, $($param: $ptype),*) -> Result<AsyncStreamingCall<$stream_ret, $final_ret>, BamlError> {
                let args = self.options.to_baml_args()
                    $(.arg(stringify!($param), $param.baml_encode()))*;
                get_runtime().call_function_stream_async(stringify!($name), &args)
            }

            pub fn parse(&self, response: &str) -> Result<$final_ret, BamlError> {
                get_runtime().parse(stringify!($name), response, false)
            }

            pub fn parse_stream(&self, response: &str) -> Result<$stream_ret, BamlError> {
                get_runtime().parse(stringify!($name), response, true)
            }
        }

        // Builder convenience methods (separate impl block via macro)
        impl_options_convenience_methods!($name);
    };
}

// =============================================================================
// Generate function structs
// =============================================================================



baml_function_async!(CodeActStep(messages: &[types::ChatMsg], tool_list: impl AsRef<str> + BamlEncode, context: impl AsRef<str> + BamlEncode, tool_names: &[String], project_instructions: impl AsRef<str> + BamlEncode, user_images: &[types::Image], include_soul: bool, headless: bool, has_history: bool, preamble: impl AsRef<str> + BamlEncode, soul: impl AsRef<str> + BamlEncode, ) -> (String, String));


baml_function_async!(SubAgentStep(messages: &[types::ChatMsg], tool_list: impl AsRef<str> + BamlEncode, context: impl AsRef<str> + BamlEncode, tool_names: &[String], project_instructions: impl AsRef<str> + BamlEncode, user_images: &[types::Image], include_soul: bool, headless: bool, has_history: bool, preamble: impl AsRef<str> + BamlEncode, soul: impl AsRef<str> + BamlEncode, ) -> (String, String));


// =============================================================================
// Client Struct
// =============================================================================

#[derive(Clone)]
pub struct BamlAsyncClient {
    options: FunctionOptions,
    
    pub CodeActStep: CodeActStep,
    
    pub SubAgentStep: SubAgentStep,
    
}

impl BamlAsyncClient {
    pub const fn new() -> Self {
        Self {
            options: FunctionOptions::new(),
            
            CodeActStep: CodeActStep::new(),
            
            SubAgentStep: SubAgentStep::new(),
            
        }
    }

    /// Apply options to all functions. Returns a new client with the options set.
    pub fn with_options(&self, options: FunctionOptions) -> Self {
        Self {
            options: options.clone(),
            
            CodeActStep: CodeActStep { options: options.clone() },
            
            SubAgentStep: SubAgentStep { options: options.clone() },
            
        }
    }
}

// Builder convenience methods
impl_options_convenience_methods!(BamlAsyncClient);

pub static B: BamlAsyncClient = BamlAsyncClient::new();