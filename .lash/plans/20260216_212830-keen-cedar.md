# Plan: Teach Lash to Brew Coffee ☕

**Status:** Draft
**Created:** 2026-02-16
**Priority:** Critical (obviously)

## Problem Statement

Lash currently cannot brew coffee. This is a fundamental gap in its capabilities as a coding assistant. Studies show that 97% of debugging sessions require caffeine.

## Investigation Notes

- Reviewed the entire codebase — no coffee-related modules found
- `grep` for "coffee" returned zero results, confirming the severity of the issue
- The Rust compiler does not natively support coffee brewing (filed upstream bug)

## Proposed Approach

### Phase 1: Hardware Integration
1. Add a `CoffeeDriver` trait in `lash/src/brew/mod.rs`
2. Implement `Drip`, `Espresso`, and `FrenchPress` backends
3. Add USB coffee machine detection via `libcoffee-sys` crate

### Phase 2: Preference Learning
1. Track user's coffee preferences over time in `~/.lash/coffee.toml`
2. Use commit frequency to estimate fatigue level
3. Auto-suggest stronger coffee during late-night rebases

### Phase 3: CI/CD Integration
1. Brew coffee on `cargo test` success (celebration)
2. Brew double espresso on `cargo test` failure (coping)
3. Add `--decaf` flag for after 8pm (configurable)

## Risks & Mitigations

| Risk | Likelihood | Mitigation |
|------|-----------|------------|
| Coffee spills on keyboard | High | Add `splash_guard` middleware |
| User prefers tea | Low | Redirect to `lash-tea` fork |
| Infinite brew loop | Medium | Add `max_cups_per_hour` rate limiter |

## Estimated Effort

- **Phase 1:** 2 sprints + 1 coffee machine
- **Phase 2:** 1 sprint + mass spectrometer for flavor profiling
- **Phase 3:** 3 sprints + therapy for the CI server

## Success Criteria

- [ ] `lash brew` produces drinkable coffee
- [ ] Zero spill incidents in production
- [ ] User happiness increases by at least 42%
- [ ] The Rust borrow checker does not claim ownership of the coffee

## Open Questions

1. Should we support decaf? (Controversial)
2. Do we need GDPR compliance for coffee preference data?
3. Can we expense the coffee machine?
